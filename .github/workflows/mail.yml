name: Daily News Audio Bot

on:
        schedule:
                        - cron: '45 19 * * *'  # UTC = JST 4:45（日本時間）
                                workflow_dispatch:       # 手動実行も可

                                jobs:
                                        build:
                                                        runs-on: ubuntu-latest

                                                                        steps:
                                                                                                - name: Checkout repository
                                                                                                                          uses: actions/checkout@v4
                                                                                                                                                  - name: Set up Python
                                                                                                                                                                            uses: actions/setup-python@v5
                                                                                                                                                                                                      with:
                                                                                                                                                                                                                                      python-version: '3.10'

                                                                                                                                                                                                                                                              - name: Install dependencies
                                                                                                                                                                                                                                                                                        run: |
                                                                                                                                                                                                                                                                                                                        python -m pip install --upgrade pip
                                                                                                                                                                                                                                                                                                                                                        pip install -r  requirements.txt

                                                                                                                                                                                                                                                                                                                                                                                - name: Run main script
                                                                                                                                                                                                                                                                                                                                                                                                          run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                          python main.py

                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: Zip MP3 output
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            zip -r news_audio_${{ github.run_id }}.zip output/

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: Upload as release
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              uses: softprops/action-gh-release@v1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        name: "Auto Audio Report ${{ github.run_id }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        tag_name: "news-audio-${{ github.run_id }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        files: news_audio_${{ github.run_id }}.zip
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}